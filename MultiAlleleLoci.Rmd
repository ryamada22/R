---
title: "多アレル座位のアレル頻度推定"
author: "ryamada"
date: "2018年3月7日"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 多項観察とディリクレ分布

２項観察の結果から、β分布に基づいて、２項の生起確率の事後分布を推定することがある。

同様に多項観察の結果から、ディリクレ分布に基づいて、多項の生起確率の事後分布を推定することがある。

本文書は、これに関する話であって、このディリクレ分布による事後分布推定では解決しない事柄を扱う。

# 離散と連続

母集団にK種類あって、X個の標本を観察する場合を考える。


## 離散
母集団が総数$N=\sum_{i=1}^K n_i$であって、観察が$X=\sum_{i=1}^K x_i$であるとする。

このような観察の生起確率は

$$
Pr(X|N) = \frac{\prod_{i=1}^K \begin{pmatrix}n_i \\ x_i \end{pmatrix}}{\begin{pmatrix}N \\ X \end{pmatrix}} 
$$
で与えられる。

ちなみに、この計算は、$2 \times K$分割表の生起確率の計算式と同じである。

```{r}
my.P.X.N <- function(N,X,log=FALSE){
  ret <- sum(lchoose(N,X))-lchoose(sum(N),sum(X))
  if(log){
    return(ret)
  }else{
    return(exp(ret))
  }
}
```
```{r}
N <- c(4,1)
X <- c(1,0)
my.P.X.N(N,X)
```

### 例題

今、$N=5$であることが知られているときに、$K=1,2$のどちらかのかに興味があるとする。

$X= (2,0)$という観察があったとしよう。

$N$の内訳が、$(5,0),(4,1),(3,2),(2,3),(1,4),(0,5)$のどれがもっともらしいかを計算してみる。

```{r}
Ns <- cbind(5:0,0:5)
X <- c(1,0)
likes <- rep(0,length(Ns[,1]))
for(i in 1:length(Ns[,1])){
  likes[i] <- my.P.X.N(Ns[i,],X)
}
plot(Ns[,1],likes,type="h")
points(Ns[,1],likes,pch=20)
```

では、N全体の種類数はK=1だったのか、K=2だったのか、その事後推定結果はどのように考えたらよいだろうか？

K=1の場合とは$N=(5,0)$の場合(と$N=(0,5)$の場合)のことである。

その尤度は
```{r}
likes[1]+likes[6]
```

他方、K=2の場合は、それ以外だから
```{r}
sum(likes[2:5])
```

この場合、尤度は$K=2$の場合の方が、$K=1$の場合よりも大きいことがわかる。

では、事後確率はどうだろうか。

事後確率は、事前分布に尤度を掛けて求める。

6通りについて、事前確率が等しいと考えていた場合には
$N=(5,0),(4,1),(3,2),(2,3),(1,4),(0,5)$
事後確率の比は、尤度そのものである。
どの$N$の事後確率がどれくらい高いかは、上記の尤度の計算に比例する。
```{r}
likes
```

この事後確率に基づいて、第１タイプの割合の期待値は計算できる。

```{r}
sum(likes/sum(likes)*(5:0)/5)
```
このとき、$K=1,2$のいずれの事後確率がどれくらい高いのかは、どう考えればよいだろうか？

尤度は
```{r}
likes[1]+likes[6]
sum(likes[2:5])
```

もし事後確率がこの尤度に比例すると考えるのであれば、
事前確率は、6通りの$N=(5,0),(4,1),(3,2),(2,3),(1,4),(0,5)$のうち、$K=1$に相当する$(5,0),(0,5)$のいずれかであるとの事前確率と、$K=2$に相当する$(4,1),(3,2),(2,3),(1,4)$のいずれかであるとの事前確率とが等しいと考えるべきである。

これは、$K=1$に相当する2つの場合の事前確率を$0.25$、$K=2$に相当する4つの場合の事前確率を$0.125$とした場合に相当するのだろう。


何を知りたいのか、その目的のために、事前確率をどのように置くかは変わるようである。

$K=1,2$の事前確率を等しくした場合の、第１タイプの割合の期待値は

```{r}
0.5 * sum(c(1,0)*likes[c(1,6)]) + 0.5*(sum((1:5)/6*likes[1:5])/sum(likes[1:5]))
```



## 連続

連続にする、とは、サンプル元のK種類の割合が有理数ではなく、実数を取ることを意味し、
サンプリングごとに、それぞれの種類の生起確率が変わらない状況のことを指すとする。

このとき、1つ以上のタイプの生起確率が0であるような、「確率」は0である。なぜなら
確率密度は正の値を取るとしても、「確率」は「幅」が無いと積分して正の値にすることができないからである。

したがって、連続の場合に、K種類のディリクレ分布を考えつつ、Kより小の種類しかない場合の「確率」を考えるためには、離散の場合と同じ考え方ではうまく行かない。



# アレル種類数

## 離散

## 連続

# 興味の対象を絞ることと事前確率

# ラベルなしの観察

